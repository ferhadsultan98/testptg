
<!DOCTYPE html>
<html lang="az">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI ≈û…ôkil Yaradƒ±cƒ±</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
  :root {
    --bg: #080d18;
    --surface: #0f1729;
    --card: #141f35;
    --border: #1e2d4a;
    --primary: #6366f1;
    --primary2: #818cf8;
    --text: #e8eef8;
    --muted: #5a6a85;
    --green: #10b981;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Segoe UI', system-ui, sans-serif;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 32px 16px 60px;
    background-image: radial-gradient(ellipse 70% 40% at 50% 0%, rgba(99,102,241,0.13) 0%, transparent 70%);
  }

  .page-title {
    text-align: center;
    margin-bottom: 28px;
  }
  .page-title .chip {
    display: inline-block;
    background: rgba(99,102,241,0.15);
    border: 1px solid rgba(99,102,241,0.35);
    color: var(--primary2);
    font-size: 10px;
    font-weight: 700;
    letter-spacing: 1.4px;
    text-transform: uppercase;
    padding: 4px 14px;
    border-radius: 20px;
    margin-bottom: 12px;
  }
  .page-title h1 {
    font-size: clamp(24px, 5vw, 38px);
    font-weight: 800;
    background: linear-gradient(135deg, #c4b5fd, #818cf8, #6366f1);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 8px;
  }
  .page-title p { color: var(--muted); font-size: 14px; }

  .card {
    width: 100%;
    max-width: 840px;
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 22px;
    padding: 28px;
    box-shadow: 0 24px 64px rgba(0,0,0,0.5);
  }

  .lbl {
    font-size: 10px;
    font-weight: 700;
    letter-spacing: 1.1px;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 7px;
    display: block;
  }

  .prompt-box { position: relative; margin-bottom: 16px; }
  textarea {
    width: 100%;
    height: 108px;
    background: var(--surface);
    border: 1.5px solid var(--border);
    color: var(--text);
    padding: 13px 15px 36px;
    border-radius: 13px;
    resize: none;
    font-size: 15px;
    line-height: 1.6;
    font-family: inherit;
    transition: border-color .2s, box-shadow .2s;
  }
  textarea::placeholder { color: var(--muted); }
  textarea:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(99,102,241,.2);
  }
  .char {
    position: absolute;
    bottom: 11px;
    right: 13px;
    font-size: 11px;
    color: var(--muted);
    pointer-events: none;
  }
  .char.over { color: #f59e0b; }

  .controls {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
    margin-bottom: 14px;
  }
  .ctrl { display: flex; flex-direction: column; }

  select {
    background: var(--surface);
    border: 1.5px solid var(--border);
    color: var(--text);
    padding: 10px 32px 10px 13px;
    border-radius: 12px;
    font-size: 13px;
    cursor: pointer;
    outline: none;
    -webkit-appearance: none;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20'%3E%3Cpath stroke='%235a6a85' stroke-width='1.5' fill='none' d='M6 8l4 4 4-4'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 9px center;
    background-size: 18px;
    transition: border-color .2s;
  }
  select:focus { border-color: var(--primary); }
  select option { background: #141f35; }

  .enhance-row {
    display: flex;
    align-items: center;
    gap: 10px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 10px 14px;
    margin-bottom: 18px;
    cursor: pointer;
    user-select: none;
  }
  .toggle { position: relative; width: 40px; height: 22px; flex-shrink: 0; }
  .toggle input { display: none; }
  .tog-track {
    position: absolute;
    inset: 0;
    background: var(--border);
    border-radius: 22px;
    transition: background .2s;
  }
  .tog-thumb {
    position: absolute;
    width: 16px; height: 16px;
    background: #fff;
    border-radius: 50%;
    top: 3px; left: 3px;
    transition: transform .2s;
  }
  .toggle input:checked ~ .tog-track { background: var(--primary); }
  .toggle input:checked ~ .tog-thumb { transform: translateX(18px); }
  .enhance-label { flex: 1; font-size: 13px; color: var(--text); }
  .enhance-label small { display: block; font-size: 11px; color: var(--muted); margin-top: 1px; }
  .ai-tag {
    font-size: 10px; font-weight: 700;
    background: rgba(99,102,241,.18);
    color: var(--primary2);
    padding: 2px 8px; border-radius: 6px; letter-spacing: .5px;
  }

  #genBtn {
    width: 100%;
    padding: 15px;
    background: linear-gradient(135deg, #6366f1, #7c3aed);
    color: #fff;
    border: none;
    border-radius: 14px;
    font-size: 16px;
    font-weight: 700;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 9px;
    box-shadow: 0 4px 22px rgba(99,102,241,.35);
    transition: all .2s;
    margin-bottom: 24px;
    letter-spacing: .3px;
  }
  #genBtn:hover:not(:disabled) {
    background: linear-gradient(135deg, #4f46e5, #6d28d9);
    box-shadow: 0 6px 30px rgba(99,102,241,.5);
    transform: translateY(-1px);
  }
  #genBtn:active:not(:disabled) { transform: none; }
  #genBtn:disabled {
    background: var(--border);
    color: var(--muted);
    cursor: not-allowed;
    box-shadow: none;
    transform: none;
  }

  #resultWrap {
    width: 100%;
    min-height: 320px;
    background: var(--surface);
    border: 2px dashed var(--border);
    border-radius: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    transition: border .3s;
  }
  #resultWrap.loaded {
    border: 1.5px solid var(--border);
    min-height: unset;
  }

  .empty {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
    color: var(--muted);
    padding: 50px 20px;
    text-align: center;
  }
  .empty i { font-size: 44px; opacity: .22; }
  .empty p { font-size: 14px; }

  #loader {
    display: none;
    flex-direction: column;
    align-items: center;
    gap: 16px;
    padding: 50px 20px;
  }
  .spin {
    width: 52px; height: 52px;
    border: 4px solid var(--border);
    border-top-color: var(--primary);
    border-radius: 50%;
    animation: spin .75s linear infinite;
  }
  @keyframes spin { to { transform: rotate(360deg); } }
  .prog-wrap {
    width: 180px; height: 3px;
    background: var(--border);
    border-radius: 3px;
    overflow: hidden;
  }
  .prog-bar {
    height: 100%;
    background: linear-gradient(90deg, var(--primary), #a855f7);
    border-radius: 3px;
    width: 0;
    transition: width 1s ease;
  }
  .loader-txt { font-size: 14px; color: var(--muted); }

  #errBox {
    display: none;
    flex-direction: column;
    align-items: center;
    gap: 10px;
    padding: 40px 20px;
    text-align: center;
  }
  #errBox i { font-size: 32px; color: #ef4444; opacity: .7; }
  #errBox strong { color: #ef4444; font-size: 15px; }
  #errBox p { font-size: 13px; color: var(--muted); max-width: 340px; }
  .retry {
    background: rgba(239,68,68,.12);
    border: 1px solid rgba(239,68,68,.3);
    color: #ef4444;
    padding: 8px 20px;
    border-radius: 10px;
    font-size: 13px; font-weight: 600;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 6px;
    transition: background .2s;
  }
  .retry:hover { background: rgba(239,68,68,.22); }

  #resultImg {
    display: none;
    width: 100%;
    border-radius: 14px;
    object-fit: contain;
  }

  #metaRow {
    display: none;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 12px;
    align-items: center;
  }
  .chips { display: flex; flex-wrap: wrap; gap: 6px; }
  .chip {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    background: var(--surface);
    border: 1px solid var(--border);
    padding: 3px 10px;
    border-radius: 8px;
    font-size: 11px;
    color: var(--muted);
  }
  .chip i { font-size: 10px; }

  #dlBtn {
    display: none;
    width: 100%;
    padding: 13px;
    background: linear-gradient(135deg, #10b981, #059669);
    color: #fff;
    border: none;
    border-radius: 13px;
    font-size: 14px; font-weight: 700;
    cursor: pointer;
    align-items: center;
    justify-content: center;
    gap: 8px;
    margin-top: 12px;
    box-shadow: 0 4px 18px rgba(16,185,129,.25);
    transition: all .2s;
  }
  #dlBtn:hover { transform: translateY(-1px); box-shadow: 0 6px 24px rgba(16,185,129,.4); }
  #dlBtn:disabled { opacity: .7; cursor: not-allowed; transform: none; }

  footer {
    margin-top: 24px;
    font-size: 12px;
    color: var(--muted);
    text-align: center;
  }

  @media (max-width: 600px) {
    .card { padding: 18px; }
    .controls { grid-template-columns: 1fr 1fr; }
    .controls .ctrl:last-child { grid-column: 1/-1; }
    #resultWrap { min-height: 240px; }
  }
  @media (max-width: 380px) {
    .controls { grid-template-columns: 1fr; }
    .controls .ctrl:last-child { grid-column: auto; }
  }
</style>
</head>
<body>

<div class="page-title">
  <div class="chip"><i class="fa-solid fa-seedling"></i>&nbsp; Pollinations AI</div>
  <h1><i class="fa-solid fa-wand-magic-sparkles"></i> AI ≈û…ôkil Yaradƒ±cƒ±</h1>
  <p>X…ôyal etdiyinizi yazƒ±n ‚Äî s√ºni intellekt anƒ±nda ≈ü…ôkil yaratsƒ±n</p>
</div>

<div class="card">

  <label class="lbl">≈û…ôkil T…ôsviri</label>
  <div class="prompt-box">
    <textarea id="prompt"
      placeholder="M…ôs…ôl…ôn: G…ôl…ôc…ôyin Bakƒ± ≈ü…ôh…ôri, u√ßan ma≈üƒ±nlar, kiberpank stili, neon i≈üƒ±qlar, gec…ô, yaƒüƒ±≈ü, ultra detallƒ±, 8k..."></textarea>
    <span class="char" id="charLbl">0 / 500</span>
  </div>

  <div class="controls">
    <div class="ctrl">
      <label class="lbl">Model</label>
      <select id="model">
        <option value="flux">‚ú¶ Flux ‚Äî ∆èn Yax≈üƒ±</option>
        <option value="flux-realism">‚ú¶ Flux Realism</option>
        <option value="flux-anime">‚ú¶ Flux Anime</option>
        <option value="flux-3d">‚ú¶ Flux 3D</option>
        <option value="turbo">‚ö° Turbo ‚Äî S√ºr…ôtli</option>
      </select>
    </div>
    <div class="ctrl">
      <label class="lbl">√ñl√ß√º</label>
      <select id="ratio">
        <option value="1024x1024">‚¨ú Kvadrat 1:1</option>
        <option value="768x1344">üì± Telefon 9:16</option>
        <option value="1344x768">üñ• Geni≈ü 16:9</option>
        <option value="832x1216">üì∑ Portret 2:3</option>
        <option value="1216x832">üñº Landscape 3:2</option>
      </select>
    </div>
    <div class="ctrl">
      <label class="lbl">Seed</label>
      <select id="seed">
        <option value="">üé≤ T…ôsad√ºfi</option>
        <option value="42">42</option>
        <option value="123">123</option>
        <option value="777">777</option>
        <option value="1337">1337</option>
        <option value="9999">9999</option>
      </select>
    </div>
  </div>

  <label class="enhance-row" for="enhTog">
    <div class="toggle">
      <input type="checkbox" id="enhTog" checked>
      <div class="tog-track"></div>
      <div class="tog-thumb"></div>
    </div>
    <div class="enhance-label">
      Prompt G√ºcl…ôndir
      <small>AI avtomatik olaraq promptu daha detallƒ± edir</small>
    </div>
    <span class="ai-tag">AI BOOST</span>
  </label>

  <button id="genBtn">
    <i class="fa-solid fa-image" id="btnIco"></i>
    <span id="btnTxt">≈û…ôkil Yarat</span>
  </button>

  <div id="resultWrap">
    <div class="empty" id="emptyBox">
      <i class="fa-regular fa-image"></i>
      <p>N…ôtic…ô burada g√∂r√ºn…ôc…ôk</p>
    </div>

    <div id="loader">
      <div class="spin"></div>
      <div class="prog-wrap"><div class="prog-bar" id="progBar"></div></div>
      <p class="loader-txt" id="loaderTxt">≈û…ôkil yaradƒ±lƒ±r...</p>
    </div>

    <div id="errBox">
      <i class="fa-solid fa-triangle-exclamation"></i>
      <strong>X…ôta ba≈ü verdi</strong>
      <p id="errMsg">Server cavab verm…ôdi. Yenid…ôn c…ôhd edin.</p>
      <button class="retry" id="retryBtn"><i class="fa-solid fa-rotate-right"></i> Yenid…ôn C…ôhd Et</button>
    </div>

    <img id="resultImg" alt="AI t…ôr…ôfind…ôn yaradƒ±lmƒ±≈ü ≈ü…ôkil">
  </div>

  <div id="metaRow">
    <div class="chips">
      <span class="chip"><i class="fa-solid fa-microchip"></i> <span id="mModel">‚Äî</span></span>
      <span class="chip"><i class="fa-solid fa-expand"></i> <span id="mSize">‚Äî</span></span>
      <span class="chip"><i class="fa-solid fa-hashtag"></i> <span id="mSeed">‚Äî</span></span>
    </div>
  </div>

  <button id="dlBtn">
    <i class="fa-solid fa-download"></i> ≈û…ôkli Y√ºkl…ô (Tam Keyfiyy…ôt)
  </button>

</div>

<footer>Pollinations.AI ¬∑ Pulsuz ¬∑ Qeydiyyatsƒ±z ¬∑ A√ßƒ±q M…ônb…ôli</footer>

<script>
// ‚îÄ‚îÄ Elements ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const promptEl   = document.getElementById('prompt');
const charLbl    = document.getElementById('charLbl');
const modelSel   = document.getElementById('model');
const ratioSel   = document.getElementById('ratio');
const seedSel    = document.getElementById('seed');
const enhTog     = document.getElementById('enhTog');
const genBtn     = document.getElementById('genBtn');
const btnIco     = document.getElementById('btnIco');
const btnTxt     = document.getElementById('btnTxt');
const resultWrap = document.getElementById('resultWrap');
const emptyBox   = document.getElementById('emptyBox');
const loaderEl   = document.getElementById('loader');
const loaderTxt  = document.getElementById('loaderTxt');
const progBar    = document.getElementById('progBar');
const errBox     = document.getElementById('errBox');
const errMsg     = document.getElementById('errMsg');
const retryBtn   = document.getElementById('retryBtn');
const resultImg  = document.getElementById('resultImg');
const metaRow    = document.getElementById('metaRow');
const mModel     = document.getElementById('mModel');
const mSize      = document.getElementById('mSize');
const mSeed      = document.getElementById('mSeed');
const dlBtn      = document.getElementById('dlBtn');

// ‚îÄ‚îÄ State ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let lastUrl    = '';
let lastParams = null;
let progTimers = [];
let msgTimer   = null;
let killTimer  = null;

// ‚îÄ‚îÄ Char counter ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
promptEl.addEventListener('input', () => {
  const n = promptEl.value.length;
  charLbl.textContent = `${n} / 500`;
  charLbl.classList.toggle('over', n > 420);
});

// ‚îÄ‚îÄ Retry ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
retryBtn.addEventListener('click', () => { if (lastParams) generate(lastParams); });

// ‚îÄ‚îÄ Generate button ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
genBtn.addEventListener('click', () => {
  const p = promptEl.value.trim();
  if (!p) {
    promptEl.style.borderColor = '#ef4444';
    promptEl.focus();
    setTimeout(() => { promptEl.style.borderColor = ''; }, 1800);
    return;
  }
  const [w, h] = ratioSel.value.split('x').map(Number);
  const model  = modelSel.value;
  const enhance= enhTog.checked;
  const seed   = seedSel.value !== ''
    ? parseInt(seedSel.value)
    : Math.floor(Math.random() * 999998) + 1;

  lastParams = { prompt: p, w, h, model, enhance, seed };
  generate(lastParams);
});

// ‚îÄ‚îÄ Main generate function ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function generate({ prompt, w, h, model, enhance, seed }) {

  // Build Pollinations URL
  // D…ôqiq s…ôn…ôdl…ô uyƒüun: https://image.pollinations.ai/prompt/{encodedPrompt}?params
  const params = new URLSearchParams({
    width:   w,
    height:  h,
    seed:    seed,
    model:   model,
    nologo:  'true',
    enhance: enhance ? 'true' : 'false',
    private: 'false',
  });
  const url = `https://image.pollinations.ai/prompt/${encodeURIComponent(prompt)}?${params.toString()}`;
  lastUrl = url;

  // Update meta
  mModel.textContent = model;
  mSize.textContent  = `${w}√ó${h}`;
  mSeed.textContent  = seed;

  setUI('loading');
  startProgress();
  startMsgRotation();

  // Vaxt a≈üƒ±mƒ± ‚Äî 90 saniy…ô
  killTimer = setTimeout(() => {
    cleanup();
    setUI('error', 'Vaxt a≈üƒ±mƒ± (90s). Server y√ºkl√ºd√ºr, bir az sonra yenid…ôn c…ôhd edin.');
  }, 90000);

  // ‚îÄ‚îÄ ≈û…ôkil y√ºkl…ôm…ô ‚îÄ‚îÄ
  // ∆èn etibarlƒ± yol: img.onload/onerror ‚Äî CORS problemi yoxdur
  const img = new Image();

  img.onload = () => {
    cleanup();
    // ≈û…ôkil y√ºkl…ôndi ‚Äî resultImg-…ô eyni URL-i veririk
    resultImg.src = url;
    setUI('done');
  };

  img.onerror = () => {
    cleanup();
    setUI('error', '≈û…ôkil y√ºkl…ôn…ô bilm…ôdi. Ba≈üqa model v…ô ya f…ôrqli prompt sƒ±nayƒ±n.');
  };

  // Y√ºkl…ônm…ôni ba≈ülat
  img.src = url;
}

// ‚îÄ‚îÄ Cleanup timers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function cleanup() {
  clearTimeout(killTimer);
  clearInterval(msgTimer);
  stopProgress();
}

// ‚îÄ‚îÄ Progress bar ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function startProgress() {
  progTimers.forEach(clearTimeout);
  progTimers = [];
  progBar.style.transition = 'none';
  progBar.style.width = '0%';

  const steps = [[600,12],[2000,32],[4500,55],[8000,72],[14000,84],[22000,91],[35000,95]];
  steps.forEach(([delay, pct]) => {
    const t = setTimeout(() => {
      progBar.style.transition = 'width 1.2s ease';
      progBar.style.width = pct + '%';
    }, delay);
    progTimers.push(t);
  });
}

function stopProgress() {
  progTimers.forEach(clearTimeout);
  progTimers = [];
  progBar.style.transition = 'width .3s ease';
  progBar.style.width = '100%';
  setTimeout(() => {
    progBar.style.transition = 'none';
    progBar.style.width = '0%';
  }, 500);
}

// ‚îÄ‚îÄ Loader messages ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function startMsgRotation() {
  clearInterval(msgTimer);
  const msgs = [
    '≈û…ôkil yaradƒ±lƒ±r...',
    'AI r…ôsm edir...',
    'Detallar …ôlav…ô edilir...',
    'Keyfiyy…ôt artƒ±rƒ±lƒ±r...',
    'Az qaldƒ±...',
  ];
  let i = 0;
  msgTimer = setInterval(() => {
    i = (i + 1) % msgs.length;
    loaderTxt.textContent = msgs[i];
  }, 3500);
}

// ‚îÄ‚îÄ UI state manager ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function setUI(state, msg) {
  // Reset all
  emptyBox.style.display  = 'none';
  loaderEl.style.display  = 'none';
  errBox.style.display    = 'none';
  resultImg.style.display = 'none';
  metaRow.style.display   = 'none';
  dlBtn.style.display     = 'none';
  resultWrap.classList.remove('loaded');

  if (state === 'loading') {
    genBtn.disabled         = true;
    btnIco.className        = 'fa-solid fa-spinner fa-spin';
    btnTxt.textContent      = 'Yaradƒ±lƒ±r...';
    loaderEl.style.display  = 'flex';
    resultWrap.style.cssText = 'border-style: solid;';

  } else if (state === 'done') {
    genBtn.disabled         = false;
    btnIco.className        = 'fa-solid fa-rotate-right';
    btnTxt.textContent      = 'Yenid…ôn Yarat';
    resultImg.style.display = 'block';
    resultWrap.classList.add('loaded');
    metaRow.style.display   = 'flex';
    dlBtn.style.display     = 'flex';

  } else if (state === 'error') {
    genBtn.disabled         = false;
    btnIco.className        = 'fa-solid fa-image';
    btnTxt.textContent      = '≈û…ôkil Yarat';
    errMsg.textContent      = msg || 'Nam…ôlum x…ôta ba≈ü verdi.';
    errBox.style.display    = 'flex';

  } else { // idle
    genBtn.disabled         = false;
    btnIco.className        = 'fa-solid fa-image';
    btnTxt.textContent      = '≈û…ôkil Yarat';
    emptyBox.style.display  = 'flex';
  }
}

// ‚îÄ‚îÄ Download ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Pollinations cross-origin ≈ü…ôkildir, birba≈üa fetch il…ô blob alƒ±b y√ºkl…ôyirik
dlBtn.addEventListener('click', async () => {
  if (!lastUrl) return;

  const orig = dlBtn.innerHTML;
  dlBtn.innerHTML  = '<i class="fa-solid fa-spinner fa-spin"></i> Hazƒ±rlanƒ±r...';
  dlBtn.disabled   = true;

  try {
    const res  = await fetch(lastUrl);
    if (!res.ok) throw new Error('fetch failed');
    const blob = await res.blob();
    const burl = URL.createObjectURL(blob);
    const a    = document.createElement('a');
    const ts   = new Date().toISOString().slice(0,19).replace(/[T:]/g, '-');
    a.href     = burl;
    a.download = `AI_Sekil_${mModel.textContent}_${ts}.jpg`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    setTimeout(() => URL.revokeObjectURL(burl), 5000);
  } catch {
    // CORS blok ed…ôrs…ô yeni sekmede a√ß
    window.open(lastUrl, '_blank');
  }

  dlBtn.innerHTML = orig;
  dlBtn.disabled  = false;
});
</script>
</body>
</html>